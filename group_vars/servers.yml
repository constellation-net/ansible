---
flux:
  cluster_domain: starsystem.dev
  git:
    owner: constellation-net
    repository: cluster
    private_key:
      local_path: ~/Documents/Constellation/Keys/id_constellation.ed25519
      remote_path: /tmp/flux_git.key # Flux stores a copy of the key in the cluster as a Secret
      password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        34636338333738663230643937376263303231623434306238323630313465373535646365326532
        6330383061353534666565623263346135663437336162650a363362653735303631626563383732
        34613564303737636132333264363832316565386231333335316466373265333236346130633738
        3037643661306433320a386361336266356238636261376462663666373034333437383030636638
        6261

server:
  token: !vault |
    $ANSIBLE_VAULT;1.1;AES256
    34623137663533613466663166333337313439353432383063363336353832306562393634353135
    3165326231313231363233613634336134333435346237340a386264663137653734323039613064
    31343631326137646665346531316565653766646431613963363436366164396564623035363763
    6135626464346338610a303965663063383933353135346634663331393634366633343831616433
    66646239303431306566646430643364333137623165626264613363646438613431
  cluster:
    domain: cluster.starsystem.dev
    # Anyone can read the file, allowing kubectl to be used without sudo
    # Shouldn't be a security risk
    kubeconfig_write_mode: "0644"
    disable: 
      - traefik # Managed ourselves via Flux
      - servicelb # Replaced with kube-vip
      - local-storage # We manage this ourselves
    disable_cloud_controller: true # So kube-vip can manage LoadBalancer services
    flannel_backend: wireguard-native # This seemed to fix a few issues I was having with nodes connecting to each other
    # Secret resources will be encrypted on disk while at-rest 
    encrypt_secrets: true
    tls_san:
      - 192.168.1.119 # Virtual IP of the cluster

kubeconfig:
  local_copy:
    remote_ip: 192.168.1.119